{% extends "pyensemble/base.html" %}
{% load i18n %}

{% block head %}
    <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
{% endblock %}

{% block title %}{% trans "PyEnsemble Group Reports" %}{% endblock %}

{% block header %}
<nav class="navbar navbar-expand-sm navbar-light fixed-top bg-light">
    <a class="navbar-brand" href="{% url 'pyensemble-group:report' %}">PyEnsemble Group Reports</a>
    <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#editor-navbar" aria-expanded="false" aria-controls="primary-navbar">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="primary-navbar">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item d-none">
                {% include "pyensemble/selectors/selector.html" with level="Study" options=studies%}
            </li>
            <li class="nav-item">
                {% include "pyensemble/selectors/selector.html" with level="Experiment" options=experiments%}
            </li>
            <li id="session-list" class="nav-item">
            </li>
        </ul>
    </div>
</nav>
<nav class="navbar">
    <div class="d-none" id="secondary-navbar">
        <ul class="navbar-nav mr-auto">

        </ul>
    </div>
</nav>
{% endblock %}


{% block main %}
<div class="container" id="results_section">    
        <div id="item_title" class="m-3 h4"></div>
        <div id="results_table" class="mt-2 overflow-auto sticky-top"></div>
</div>
{% endblock %}


{% block appscript %}
    <script>
        $(function() {
            function onChangedSelection (e, clickedIndex, isSelected, previousValue) {

                var level = e.target.name.toLowerCase();
                var item_id = e.target.options[clickedIndex].value;
                var url = "";

                if (level == 'experiment'){
                    url = "{% url 'pyensemble-group:experiment-session-selector' %}";
                }
                else if (level == "session"){
                    url = "{% url 'pyensemble-group:session-detail' %}";
                }

                $.ajax({
                    url: url,
                    type: 'GET',
                    data: {
                        'id': item_id,
                    },
                    dataType: 'html',
                    success: function(response){
                        if (level == "experiment"){
                            $("#session-list").html(response);
                            $(".selectpicker[name='session']")
                                .selectpicker('show')
                                .on('changed.bs.select', onChangedSelection);
                        } 
                        else if (level == "session"){
                            $("#results_table").html(response);
                        }
                    },

                });
            }

            $('.selectpicker').selectpicker().on('changed.bs.select', onChangedSelection);


        });
    </script>
{% endblock %}

